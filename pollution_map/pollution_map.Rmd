---
title: "pollution_map"
output: html_document
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
install.packages("leaflet") # Source: https://rstudio.github.io/leaflet/
library(leaflet)
library(maps)
```

## Load Data 

```{r load-data, message = FALSE}
# air pollution data
death_rates_from_air_pollution_csv <- read_csv(
  here("data", "death-rates-from-air-pollution.csv"), show_col_types = FALSE)

number_deaths_by_risk_factor_csv <- read_csv(
  here("data", "number-of-deaths-by-risk-factor.csv"), show_col_types = FALSE)

# gdp data
gdp_by_country_csv <- read_csv(
  here("data", "gdp-data.csv"), show_col_types = FALSE)

# NOTE: added _csv ending to eliminate need for naming later versions "clean"

# world map data
world_map_data <- map_data("world") %>% 
  as_tibble()
```

```{r clean-datasets}

#renaming variables to clean them up 

death_rates_from_air_pollution <- death_rates_from_air_pollution_csv %>%
  clean_names() %>%
  rename(
    death_rate_air_pollution =
      deaths_air_pollution_sex_both_age_age_standardized_rate,
    death_rate_household_pollution = deaths_household_air_pollution_from_solid_fuels_sex_both_age_age_standardized_rate,
    death_rate_ambient_matter_pollution = deaths_ambient_particulate_matter_pollution_sex_both_age_age_standardized_rate,
    death_rate_ozone_pollution =
      deaths_ambient_ozone_pollution_sex_both_age_age_standardized_rate
  )

number_deaths_by_risk_factor <- number_deaths_by_risk_factor_csv %>%
  clean_names()

gdp_by_country <- gdp_by_country_csv %>%
  clean_names() %>%
  pivot_wider()
```

```{r data wrangling}
air_pollution_joined <- death_rates_from_air_pollution %>% 
  left_join(number_deaths_by_risk_factor, by = c("entity", "year", "code"))

total_joined <- world_map_data %>% 
  left_join(air_pollution_joined, by = c("region" = "entity"))

to_do <- world_map_data %>% 
  anti_join(air_pollution_joined, by = c("region" = "entity"))
  
to_do %>% 
  unique("region")

world_map_data 

```

```{r leaflet}

# following tutorial at URL below, i think we need to figure out how to join the data first 
bins <- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)
pal <- colorBin("YlOrRd", domain = total_joined$death_rate_air_pollution, 
                bins = bins)

# once we join the data this code should be a good start

world_map = map("world", fill = TRUE, plot = FALSE)

  leaflet(data = total_joined) %>% 
  addTiles() %>%
  addPolygons(fillColor = ~pal(death_rate_air_pollution), 
              weight = 2, 
              opacity = 1, 
              color = "white", 
              dashArray = "3", 
              fillOpacity - 0.7)

leaf <- 
  leaflet(data = total_joined) %>% 
  addTiles()

my_long <- 
  leaf %>%
  getMapData() %>%
  pull(long)

my_lat <- 
  leaf %>%
  getMapData() %>%
  pull(lat)


  leaf %>%
  addPolygons(fillColor = ~pal(death_rate_air_pollution), 
              weight = 2, 
              opacity = 1, 
              color = "white", 
              dashArray = "3", 
              lng = my_long, 
              lat = my_lat)

# this is just a start, obviously 

# things we want to consider: 
  # how to not have it repeat (for user friendly-ness)
      #setView?
  # is it a problem this does not use ggplot? 
  # how to change polygon fill 
  # how to join air pollution data to world_map (which looks like a list) - prioritize asking this in Lab 
    # https://rstudio.github.io/leaflet/choropleths.html
  
  
  
  world_map = map("world", fill = TRUE, plot = FALSE)

  leaflet(data = world_map) %>% 
  addTiles()
```



