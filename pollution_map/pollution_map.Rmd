---
title: "pollution_map"
output: html_document
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
install.packages("leaflet") # Source: https://rstudio.github.io/leaflet/
library(leaflet)
library(maps)
```

## Load Data 

```{r load-data, message = FALSE}
# air pollution data
death_rates_from_air_pollution_csv <- read_csv(
  here("data", "death-rates-from-air-pollution.csv"), show_col_types = FALSE)

number_deaths_by_risk_factor_csv <- read_csv(
  here("data", "number-of-deaths-by-risk-factor.csv"), show_col_types = FALSE)

# gdp data
gdp_by_country_csv <- read_csv(
  here("data", "gdp-data.csv"), show_col_types = FALSE)

# NOTE: added _csv ending to eliminate need for naming later versions "clean"

# world map data
world_map_data <- map_data("world") %>% 
  as_tibble()
```

```{r clean-datasets}

#renaming variables to clean them up 

death_rates_from_air_pollution <- death_rates_from_air_pollution_csv %>%
  clean_names() %>%
  rename(
    death_rate_air_pollution =
      deaths_air_pollution_sex_both_age_age_standardized_rate,
    death_rate_household_pollution = deaths_household_air_pollution_from_solid_fuels_sex_both_age_age_standardized_rate,
    death_rate_ambient_matter_pollution = deaths_ambient_particulate_matter_pollution_sex_both_age_age_standardized_rate,
    death_rate_ozone_pollution =
      deaths_ambient_ozone_pollution_sex_both_age_age_standardized_rate
  )

number_deaths_by_risk_factor <- number_deaths_by_risk_factor_csv %>%
  clean_names()

gdp_by_country <- gdp_by_country_csv %>%
  clean_names() %>%
  pivot_wider()
```

```{r data wrangling}
# joining air pollution data together
air_pollution_joined <- death_rates_from_air_pollution %>% 
  left_join(number_deaths_by_risk_factor, by = c("entity", "year", "code"))

# Next Step: Do a series of case_when (before join) to resolve inconsistencies (sample code below)

# joining air pollution to world_map_data
total_joined <- world_map_data %>% 
  left_join(air_pollution_joined, by = c("region" = "entity"))

to_do <- world_map_data %>% 
  anti_join(air_pollution_joined, by = c("region" = "entity"))
  
to_do %>% 
  pull(region) %>% 
  unique()

```

Sample Code from Class: 

# clean fisheries data  ----------------------------------------------------------------
fisheries <- fisheries %>%
  mutate(
    country = case_when(country == "United States" ~ "USA",
                             country == "United Kingdom" ~ "USA",
                             country == "" ~ "",
         TRUE ~ country))

#clean world map data

world_map <- world_map_raw %>%
  mutate(region = case_when(
    subregion == "Hong Kong" ~ region == "Hong Kong",
    region == "Antigua" ~ "Antigua and Barbuda",
    region == "Barbuda" ~ "Antigua and Barbuda",
    TRUE ~ region))
    
    
```{r join and test map}
ggplot(total_joined, aes(long, lat)) + 
  geom_polygon(aes(group = group, fill = death_rate_air_pollution), color = "black") + 
  coord_map(projection = "mercator", 
            xlim = c(-180, 180)) + 
  theme_void()
```







